{% extends "Dashboard/base.html" %}
{% load static %}


{% block css %}
{% endblock %}
current

{% block extra_meta %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}


{% block title %}
    Dashboard
{% endblock %}

{% block content %}        



    <!-- content -->
<div class="mb-0">
  <div class="m-2">
      <div class="row d-flex justify-content-center">
          <a href="{% url 'overall_analysis' %}"
          class=" btn btn-primary col-md-2  d-flex flex-column justify-content-center bgdash rounded-2 border border-2 border-light rounded-4">
              <h5>Orphans Summary 
                  <i class="txtColor icon fa-solid fa-children fs-4   border-0"></i>
              </h5>
              <span style="font-size: 70%">A summary of information and current status for each orphan</span>
              <!-- <h1 class="text-center mt-3">100</h1> -->
              <!-- {{ total_orphans }} -->
          </a>

          <div
              class=" col-md-2  d-flex flex-column justify-content-center bgdash rounded-2 border border-2 border-light rounded-4">
              <h5 class="pt-2 text-center">Gender <i class="txtColor icon fa-solid fa-venus-mars fs-5"></i></h5>
              <div class="row">
                  <div class="col-6 d-flex justify-content-center align-items-center">
                      <p class="m-1">Male</p>
                  </div>
                  <div class="col-6 d-flex justify-content-center align-items-center">
                      <span class="badge bg-success rounded-pill">{{ male_count }}</span>
                  </div>
                  <div class="col-6 d-flex justify-content-center align-items-center">
                      <p class="m-1">Female</p>
                  </div>
                  <div class="col-6 d-flex justify-content-center align-items-center">
                      <span class="badge bg-danger rounded-pill">{{ female_count}}</span>
                  </div>
                  <hr class="mb-1">
                  <div class="col-6 d-flex justify-content-center align-items-center">
                      <p class="m-1">Total</p>
                  </div>
                  <div class="col-6 d-flex justify-content-center align-items-center">
                      <span class="badge bg-secondary rounded-pill">{{ total_orphans}}</span>
                  </div>
              </div>
          </div>

          <div
          class=" btn  btn-primary col-md-2  d-flex flex-column justify-content-center bgdash rounded-2 border border-2 border-light rounded-4">
          <!-- <a href="{% url 'chart_age' %}" class="text-decoration-none txtColor"> -->
            <a href="{% url 'chart_age' %}" class="text-decoration-none txtColor">
              <h5 class="pt-2">Age Distribution
                <i class="txtColor icon fa-solid fa-building-circle-exclamation fs-5"></i></h5>
              <h1 class="text-center mt-3"> </h1>
              <span style="font-size: 70%">A breakdown of ages within our organization</span>

              <!-- <p>Needs Intervention</p> -->
          </a>
      </div>

    <div
      class=" btn  btn-primary col-md-2  d-flex flex-column justify-content-center bgdash rounded-2 border border-2 border-light rounded-4">
        <a  href="{% url 'intervention_behavior' %}" class="text-decoration-none txtColor">

          <h5 class="pt-2">Behavior <i class="txtColor icon fa-solid fa-person-circle-exclamation fs-5"></i>
          </h5>
          <h1 class="text-center mt-3">{{ requires_intervention_behavior }}</h1>
          <p>Needs Intervention</p>
      </a>
    </div>
          <div
              class=" btn  btn-primary col-md-2  d-flex flex-column justify-content-center bgdash rounded-2 border border-2 border-light rounded-4">

                <a  href="{% url 'intervention_academics' %}" class="text-decoration-none txtColor">

                  <h5 class="pt-2">Education <i
                          class="txtColor icon fa-solid fa-building-circle-exclamation fs-5"></i></h5>
                  <h1 class="text-center mt-3">{{ requires_intervention_academics }}</h1>
                  <p>Needs Intervention</p>
              </a>
          </div>

          <div
              class=" btn  btn-primary col-md-2  d-flex flex-column justify-content-center bgdash rounded-2 border border-2 border-light rounded-4">
                <a href="{% url 'intervention_health' %}" class="text-decoration-none txtColor">

                  <h5 class="pt-2">Health <i class="txtColor icon fa-solid fa-heart-circle-exclamation fs-5"></i></h5>
                  <h1 class="text-center mt-3">{{ requires_intervention_health }}</h1>
                  <p>Needs Intervention</p>
              </a>
          </div>


      </div>
  </div>
</div>
        
<hr class="m-0 mt-0 w-100">
<!-- Charts section -->

  <div class="container mt-0 ">
  <div class="row">
    <div class="container row justify-content-center">
    <div class="col-md-6 mt-5">
      <div id="sentimentsChartContainer" class="container mt-2 mb-0 justify-content-center align-items-center d-flex p-0" style="height: 460px; flex-wrap: nowrap; flex-direction: column;">
          <!-- <h5 class="text-center mt-lg-4">Behavior Chart</h5> -->
          <canvas id="behaviorStatusChart" ></canvas>
      </div>
  </div>
  
    
    <div class="col-md-6 ">
      <div class="container mt-2 mb-0 justify-content-evenly align-items-center border border-2 rounded-2 d-flex flex-column p-0" style="height: 26.1h;">
        <a href="{% url 'dashboard_academic_chart' %}" ></a>
        <!-- <h5 class="text-center">Academic Chart</h4> -->
        <canvas id="academicStatusChart"></canvas>
      </div>
      
      <div class="container-fluid mt-2 mb-0 justify-content-evenly align-items-center border border-2 rounded-2 d-flex flex-column  p-0 chart-container">
        <a href="{% url 'dashboard_health_chart' %}" ></a>
        <!-- <h5 class="text-center">Health Chart</h5> -->
        <canvas id="healthStatusChart"></canvas>
      </div>
    </div>
    </div>
      <!-- {% comment %} 
      <div class="container mt-2 mb-0 justify-content-evenly align-items-center border border-2 rounded-2 d-flex flex-column  p-0" style="height: 26.1h;">
        <a href="{% url 'chart_age' %}"></a>
        <h5 class="text-center">Age Chart</h5>
        <canvas id="ageChart"></canvas>
      </div> 
      {% endcomment %} -->
    </div>
    
    <!-- <div class="col-md-4">
      <div class="container mt-2 mb-0 justify-content-evenly align-items-center border border-2 rounded-2 d-flex flex-column  p-0" style="height: 26.1h;">
        <a href="{% url 'chart_health' %}" ></a>
        <h5 class="text-center">Health Chart</h5>
        <canvas id="healthChart"></canvas>
      </div>
      
      <div class="container mt-2 mb-0 justify-content-evenly align-items-center border border-2 rounded-2 d-flex flex-column  p-0" style="height: 26.1h;">
        <a href="{% url 'chart_bmi' %}" ></a>
        <h5 class="text-center">BMI Chart</h5>
        <canvas id="bmiChart"></canvas>

      </div>
    </div> -->
  </div>
{% endblock %}


{% block js%}
<!-- for sentiment/behavior chart -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fetch data from the Django view
    fetch('/Dashboard/dashboard_behavior_chart/')
        .then(response => response.json())
        .then(data => {
            // Verify the data has the expected structure
            if (!data.labels || !data.datasets || !data.datasets.length) {
                throw new Error('Data format is incorrect');
            }
            const labels = data.labels;
            const counts = data.datasets[0].data;

            // Get the canvas element
            const ctx = document.getElementById('behaviorStatusChart').getContext('2d');

            // Create the pie chart
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Number of orphans',
                        data: counts,
                        backgroundColor: [
                            'rgba(255, 99, 132)', // Red
                            'rgba(255, 206, 86)', // Yellow
                            'rgba(75, 192, 192)' // Green
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)', // Red
                            'rgba(255, 206, 86, 1)', // Yellow
                            'rgba(75, 192, 192, 1)' // Green
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Behavior Categories Distribution',
                            font: {
                                size: 20
                            },
                            padding: { top: 30 }
                        },
                        subtitle: {
                            display: true,
                            text: 'Displays the count of orphans for each category for the current month',
                            font: {size: 12}
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                }
                            }
                }
            }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
});





</script>

</script>



<!-- ACADEMIC CHART -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
      const ctx = document.getElementById('academicStatusChart').getContext('2d');
      let academicStatusChart;

      fetch('/Dashboard/dashboard_academic_chart/')  // Ensure this is the correct endpoint
      .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok: ' + response.statusText);
          }
          return response.json();
      })
      .then(data => {
          if (academicStatusChart) {
              academicStatusChart.destroy();
          }
          academicStatusChart = new Chart(ctx, {
              type: 'bar', // Bar chart to display counts
              data: {
                  labels: data.labels, // Labels are dynamically received from the server
                  datasets: [{
                      label: 'Number of Orphans',
                      data: data.datasets[0].data, // Make sure the data array matches the expected format
                      backgroundColor: [
                          'rgba(54, 162, 235, 0.6)', // More opaque for better visibility
                          'rgba(255, 206, 86, 0.6)',
                          'rgba(255, 99, 132, 0.6)'
                      ],
                      borderColor: [
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(255, 99, 132, 1)'
                      ],
                      borderWidth: 1
                  }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true, // Ensures that the y-axis starts from zero
                            ticks: {
                                precision: 0 // No fractional ticks on the y-axis
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true // Optionally turn off if not needed
                        },
                        title: {
                            display: true,
                            text: 'Academic Status Chart', // Replace with your desired title
                            font: { size: 20 },

                            subtitle: {
                                display: true,
                                text: 'A descriptive subtitle' // Replace with your subtitle
                            }
                        }
                    }
                }
                });
                })
      .catch(error => {
          console.error('Error fetching academic status data:', error);
          alert('Failed to load academic status data.'); // Display a simple alert or modify the DOM to show an error message
      });
  });
</script>




<!-- health chart -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('healthStatusChart').getContext('2d');
    fetch('/Dashboard/dashboard_health_chart/')
        .then(response => response.json())
        .then(data => {
            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: data.datasets[0].label,
                        data: data.datasets[0].data,
                        backgroundColor: data.datasets[0].backgroundColor,
                        borderColor: [
                            'rgba(0, 0, 0, 1)',
                            'rgba(0, 0, 0, 1)',
                            'rgba(0, 0, 0, 1)',
                            'rgba(0, 0, 0, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Monthly Health Status Distribution',
                            font: { size: 20 }
                        },
                        subtitle: {
                            display: true,
                            text: 'Categorizes health status based on the average of daily scores for the current month',
                            font: { size: 12 },
                            padding: { bottom: 10 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    let label = tooltipItem.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += tooltipItem.raw;
                                    const category = tooltipItem.label;
                                    const descriptions = {
                                        'Excellent Health': '90 - 100 points',
                                        'Good Health': '75 - 89 points',
                                        'Fair Health': '50 - 74 points',
                                        'Poor Health': 'Below 50 points'
                                    };
                                    label += ` with: (${descriptions[category]})`;
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
});
</script>



<!-- clickability of charts -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
      const behaviorChartCanvas = document.getElementById('behaviorStatusChart');
      behaviorChartCanvas.style.cursor = 'pointer';
      behaviorChartCanvas.addEventListener('click', function() {
          window.location.href = '{% url "intervention_behavior" %}';
      });
    
      const academicChartCanvas = document.getElementById('academicStatusChart');
      academicChartCanvas.style.cursor = 'pointer';
      academicChartCanvas.addEventListener('click', function() {
          window.location.href = '{% url "intervention_academics" %}';
      });
    
    //   const ageChartCanvas = document.getElementById('ageChart');
    //   ageChartCanvas.style.cursor = 'pointer';
    //   ageChartCanvas.addEventListener('click', function() {
    //       window.location.href = '{% url "chart_age" %}';
    //   });
    
      const healthChartCanvas = document.getElementById('healthStatusChart');
      healthChartCanvas.style.cursor = 'pointer';
      healthChartCanvas.addEventListener('click', function() {
          window.location.href = '{% url "intervention_health" %}';
      });
    
    //   const bmiChartCanvas = document.getElementById('bmiChart');
    //   bmiChartCanvas.style.cursor = 'pointer';
    //   bmiChartCanvas.addEventListener('click', function() {
    //       window.location.href = '{% url "chart_bmi" %}';
    //   });
    
    });
    </script>

{% endblock %}



